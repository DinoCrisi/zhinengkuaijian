# 配置管理指南

## 快速开始

### 我想修改服务地址，怎么做？

只需要修改两个文件，然后重启服务：

1. **修改前端配置**：`config/apiConfig.ts`
```typescript
const BASE_HOST = '127.0.0.1';  // 改成你想要的地址
```

2. **修改后端配置**：`server/config.py`
```python
BASE_HOST = '127.0.0.1'  # 改成相同的地址
```

3. **检查配置**：
```bash
python check_config.py
```

4. **重启所有服务**

## 常见场景

### 场景 1：本地开发（默认）

```typescript
// config/apiConfig.ts
const BASE_HOST = '127.0.0.1';
```

```python
# server/config.py
BASE_HOST = '127.0.0.1'
```

### 场景 2：局域网访问

如果你想让局域网内的其他设备访问：

```python
# server/config.py
BASE_HOST = '0.0.0.0'  # 监听所有网卡
```

```typescript
// config/apiConfig.ts
const BASE_HOST = '192.168.1.100';  // 你的电脑 IP
```

### 场景 3：服务器部署

```typescript
// config/apiConfig.ts
const BASE_HOST = 'api.example.com';
```

```python
# server/config.py
BASE_HOST = 'api.example.com'
```

## 为什么需要两个配置文件？

- **前端配置**（TypeScript）：告诉浏览器向哪里发送请求
- **后端配置**（Python）：告诉服务器在哪里监听请求

它们必须一致，否则前端无法连接到后端。

## 常见问题

### Q1：我改了配置，为什么没生效？

**A**：需要重启所有后端服务。前端如果是开发模式，会自动重新加载。

### Q2：我改成 127.0.0.2，素材库数据消失了？

**A**：这是正常的。浏览器的 localStorage 按域名隔离：
- `http://127.0.0.1:5173` 和 `http://127.0.0.2:5173` 是两个不同的域名
- 数据没有丢失，只是在另一个域名下
- 改回 `127.0.0.1` 就能看到数据了

### Q3：前端和后端配置不一致会怎样？

**A**：所有功能都会失败，因为前端请求无法到达后端。运行 `python check_config.py` 可以检测这个问题。

### Q4：我只想改端口，不想改地址？

**A**：修改 `SERVICE_PORTS` 字典：

```typescript
// config/apiConfig.ts
export const SERVICE_PORTS = {
  PROXY: 9000,  // 改成你想要的端口
  // ...
}
```

```python
# server/config.py
SERVICE_PORTS = {
    'PROXY': 9000,  # 改成相同的端口
    # ...
}
```

## 配置文件位置

```
项目根目录/
├── config/
│   ├── apiConfig.ts          # 前端配置（TypeScript）
│   ├── README.md             # 前端配置说明
│   ├── BACKEND_CONFIG.md     # 后端配置说明
│   └── 配置管理指南.md       # 本文档
├── server/
│   └── config.py             # 后端配置（Python）
└── check_config.py           # 配置检查工具
```

## 工具命令

### 检查配置一致性
```bash
python check_config.py
```

### 查看后端配置
```bash
python server/config.py
```

### 查看前端配置
```bash
# 直接打开文件
code config/apiConfig.ts
```

## 技术细节

### 前端配置原理

前端使用 TypeScript 常量：
```typescript
const BASE_HOST = '127.0.0.1';
export const API_URLS = {
  PROXY: `http://${BASE_HOST}:8888`,
  // ...
}
```

所有服务文件导入这些常量：
```typescript
import { API_URLS } from '../config/apiConfig';
```

### 后端配置原理

后端使用 Python 模块：
```python
# server/config.py
BASE_HOST = '127.0.0.1'
SERVICE_PORTS = {'PROXY': 8888, ...}
```

所有服务文件导入这个模块：
```python
from config import BASE_HOST, SERVICE_PORTS
```

## 版本历史

- **v1.0** (2026-01-29)：创建统一的全局配置系统
  - 前端配置：`config/apiConfig.ts`
  - 后端配置：`server/config.py`
  - 配置检查工具：`check_config.py`

---

**提示**：如果你不确定配置是否正确，随时运行 `python check_config.py` 检查！
